<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>회원가입 & 성향 분석</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap"
    rel="stylesheet"
  />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: "Noto Sans KR", sans-serif;
      background: linear-gradient(135deg, #fdf8f4 0%, #f0f8ff 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }
    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(253, 248, 244, 0.95);
      backdrop-filter: blur(10px);
      padding: 12px 20px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }
    .step-indicator {
      font-size: 18px;
      font-weight: 700;
      color: #333;
    }
    .header-title {
      font-size: 16px;
      font-weight: 500;
      color: #666;
    }
    .header-icons {
      display: flex;
      gap: 12px;
    }
    .header-icon {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: background-color 0.2s;
    }
    .header-icon:hover {
      background-color: rgba(240, 240, 240, 0.8);
    }
    /* Main Container */
    .main-container {
      margin-top: 80px;
      padding: 20px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    /* Progress Bar */
    .progress-bar {
      width: 100%;
      height: 6px;
      background-color: #e0e0e0;
      border-radius: 3px;
      margin-bottom: 24px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #a3e4d7, #c0b3ea);
      border-radius: 3px;
      transition: width 0.5s ease;
      width: 0%;
    }
    /* User Info Form */
    .user-info-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-bottom: 24px;
    }
    .form-title {
      font-size: 24px;
      font-weight: 700;
      color: #333;
      margin-bottom: 8px;
      text-align: center;
    }
    .form-subtitle {
      font-size: 14px;
      color: #666;
      text-align: center;
      margin-bottom: 32px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-label {
      display: block;
      font-weight: 500;
      color: #333;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s;
      background: rgba(255, 255, 255, 0.8);
    }
    .form-input:focus {
      outline: none;
      border-color: #a3e4d7;
    }
    .form-row {
      display: flex;
      gap: 16px;
    }
    .form-row .form-group {
      flex: 1;
    }
    /* Question Card */
    .question-card {
      display: none;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-bottom: 24px;
    }
    .question-card.active {
      display: block;
    }
    .question-number {
      font-size: 14px;
      color: #a3e4d7;
      font-weight: 500;
      margin-bottom: 8px;
    }
    .question-text {
      font-size: 18px;
      font-weight: 700;
      color: #333;
      margin-bottom: 8px;
      line-height: 1.4;
    }
    .options-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 32px;
    }
    .option-item {
      display: flex;
      align-items: center;
      padding: 20px;
      background: rgba(245, 245, 245, 0.8);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }
    .option-item::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.4),
        transparent
      );
      transition: left 0.5s ease;
    }
    .option-item:hover::before {
      left: 100%;
    }
    .option-item:hover {
      background: rgba(232, 248, 245, 0.9);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(163, 228, 215, 0.3);
    }
    .option-item.selected {
      background: linear-gradient(135deg, #d0f0e9, #e8e2f7);
      border-color: #a3e4d7;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(163, 228, 215, 0.4);
    }
    .option-radio {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid #ccc;
      margin-right: 16px;
      position: relative;
      flex-shrink: 0;
      transition: all 0.3s ease;
    }
    .option-item.selected .option-radio {
      border-color: #a3e4d7;
      background-color: #a3e4d7;
    }
    .option-item.selected .option-radio::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 10px;
      height: 10px;
      background-color: white;
      border-radius: 50%;
    }
    .option-text {
      font-size: 15px;
      color: #333;
      flex: 1;
      line-height: 1.4;
    }
    .option-emoji {
      font-size: 24px;
      margin-left: 16px;
    }
    /* Navigation Buttons */
    .navigation {
      display: flex;
      justify-content: space-between;
      gap: 16px;
    }
    .nav-button {
      padding: 14px 28px;
      border: 2px solid #e0e0e0;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 120px;
      position: relative;
      overflow: hidden;
    }
    .nav-button::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: radial-gradient(
        circle,
        rgba(163, 228, 215, 0.3) 0%,
        transparent 70%
      );
      transition: all 0.3s ease;
      transform: translate(-50%, -50%);
    }
    .nav-button:hover::before {
      width: 300px;
      height: 300px;
    }
    .nav-button:hover:not(:disabled) {
      border-color: #a3e4d7;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(163, 228, 215, 0.3);
    }
    .nav-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    .nav-button.next:not(:disabled) {
      background: linear-gradient(135deg, #a3e4d7, #c0b3ea);
      border-color: #a3e4d7;
      color: #333;
    }
    /* Results Screen */
    .results-container {
      display: none;
      text-align: center;
    }
    .results-container.active {
      display: block;
    }
    .completion-message {
      font-size: 28px;
      font-weight: 700;
      color: #333;
      margin-bottom: 16px;
    }
    .completion-subtitle {
      font-size: 16px;
      color: #666;
      margin-bottom: 32px;
    }
    .result-summary {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    .user-welcome {
      font-size: 20px;
      font-weight: 600;
      color: #333;
      margin-bottom: 24px;
    }
    .personality-type {
      font-size: 24px;
      font-weight: 700;
      color: #a3e4d7;
      margin-bottom: 16px;
    }
    .type-description {
      font-size: 16px;
      color: #555;
      line-height: 1.6;
      margin-bottom: 24px;
    }
    .traits-grid,
    .analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .trait-card,
    .analysis-card {
      background: linear-gradient(135deg, #f0f8ff, #fdf8f4);
      padding: 16px;
      border-radius: 12px;
      text-align: left;
    }
    .trait-label,
    .analysis-label {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 4px;
    }
    .trait-value,
    .analysis-value {
      font-size: 16px;
      font-weight: 500;
      color: #333;
    }
    .result-keywords {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 32px;
    }
    .keyword-tag {
      background: linear-gradient(135deg, #e8e2f7, #d0f0e9);
      color: #555;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }
    .analysis-title {
      font-size: 20px;
      font-weight: 600;
      color: #333;
      margin: 16px 0 8px;
      text-align: left;
    }
    .log-button {
      width: 100%;
      height: 56px;
      background: linear-gradient(135deg, #e8e2f7, #a3e4d7);
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 700;
      color: #333;
      cursor: pointer;
      margin-bottom: 16px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(163, 228, 215, 0.3);
    }
    .log-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(163, 228, 215, 0.4);
    }
    .action-buttons {
      display: flex;
      gap: 16px;
      justify-content: center;
    }
    .action-button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .action-button.home {
      background: linear-gradient(135deg, #d8efd6, #a3e4d7);
      color: #333;
    }
    .action-button.stats {
      background: linear-gradient(135deg, #fff9c4, #f0e68c);
      color: #333;
    }
    .action-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 1000;
      backdrop-filter: blur(5px);
    }
    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 32px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    .modal-header {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 16px;
      color: #333;
    }
    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }
    /* Toast */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #4caf50, #45a049);
      color: white;
      padding: 16px 24px;
      border-radius: 8px;
      display: none;
      z-index: 1001;
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
    }
    /* Responsive */
    @media (max-width: 768px) {
      .main-container {
        padding: 16px;
      }
      .question-card,
      .user-info-card {
        padding: 24px;
      }
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      .traits-grid,
      .analysis-grid {
        grid-template-columns: 1fr;
      }
      .action-buttons {
        flex-direction: column;
      }
    }
    @media (max-width: 480px) {
      .completion-message {
        font-size: 24px;
      }
      .personality-type {
        font-size: 20px;
      }
      .navigation {
        flex-direction: column;
      }
      .nav-button {
        width: 100%;
      }
    }
    .job-block {
      padding: 10px 18px;
      border-radius: 8px;
      background: #f5f5f5;
      cursor: pointer;
      font-size: 15px;
      border: 2px solid transparent;
      transition: all 0.2s;
      margin-bottom: 4px;
      user-select: none;
    }
    .job-block.selected {
      background: linear-gradient(135deg, #a3e4d7, #c0b3ea);
      color: #333;
      border-color: #a3e4d7;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="step-indicator" id="stepIndicator">회원가입 1/22</div>
    <div class="header-title">회원가입 2단계 &amp; 성향 분석 20단계</div>
  </div>

  <div class="main-container">
    <!-- Progress Bar -->
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <!-- 1단계: 기본 정보 입력 -->
    <div class="user-info-card" id="userInfoCard">
      <div class="form-title">기본 정보 입력</div>
      <div class="form-subtitle">회원가입 후 성향 분석을 진행합니다.</div>
      <div class="form-group">
        <label class="form-label" for="nameInput">닉네임(별명)</label>
        <input
          type="text"
          id="nameInput"
          class="form-input"
          placeholder="서비스에서 사용할 닉네임을 입력하세요"
        />
      </div>
      <div class="form-group">
        <label class="form-label" for="ageInput">나이</label>
        <input
          type="number"
          id="ageInput"
          class="form-input"
          placeholder="나이를 입력하세요"
        />
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="genderSelect">성별</label>
          <select id="genderSelect" class="form-input">
            <option value="">선택하세요</option>
            <option value="male">남성</option>
            <option value="female">여성</option>
          </select>
        </div>
      </div>
      <!-- 현재 직업 및 주된 활동 추가 -->
      <div class="form-group">
        <label class="form-label">현재 직업 및 주된 활동 (복수 선택 가능)</label>
        <div id="jobCategories" style="display:flex; flex-wrap:wrap; gap:10px; margin-bottom:8px;">
          <label><input type="checkbox" value="학생"> 학생</label>
          <label><input type="checkbox" value="직장인"> 직장인</label>
          <label><input type="checkbox" value="프리랜서"> 프리랜서</label>
          <label><input type="checkbox" value="창작자"> 창작자</label>
          <label><input type="checkbox" value="구직중"> 구직중</label>
          <label><input type="checkbox" value="주부"> 주부</label>
          <label><input type="checkbox" value="기타"> 기타</label>
        </div>
        <input type="text" id="jobDetailInput" class="form-input" placeholder="직접 입력 (선택)" style="display:none;">
      </div>
      <!-- 일주일 중에 자유로운 시간간 -->
      <div class="form-group">
        <label class="form-label" for="freeTimeRange" , style = 'font-size: 17px; font-weight: 1000;'>
          일주일 기준 자유로운 시간 (0~50시간): 
          <span id="freeTimeValue" style="font-weight:700; font-size:large; color:#e42f2f;">25</span>시간
        </label>
        <input type="range" id="freeTimeRange" min="0" max="50" value="25" step="1" style="width:100%;">
      </div>
      <div class="navigation">
        <button class="nav-button" id="userInfoNext" style="margin-left:auto;">다음</button>
      </div>
    </div>

    <!-- 2단계: 취미 및 콘텐츠 기반 초기 선호 (세션 분리, 선택사항) -->
    <div class="user-info-card" id="hobbyInfoCard" style="display:none;">
      <div class="form-title">취미 및 콘텐츠 기반 초기 선호</div>
      <div class="form-subtitle" style="color:#888; font-size:13px;">
        * 이 단계는 <b>선택사항</b>입니다. 입력하지 않아도 '다음'을 눌러 넘어갈 수 있습니다.
      </div>
      <div class="form-group">
        <label class="form-label">최근에 즐겨 본 컨텐츠 유형 (복수 선택)</label>
        <div id="contentTypes" style="display:flex; flex-wrap:wrap; gap:10px;">
          <label><input type="checkbox" value="게임"> 게임</label>
          <label><input type="checkbox" value="영화"> 영화</label>
          <label><input type="checkbox" value="음악"> 음악</label>
          <label><input type="checkbox" value="책"> 책</label>
          <label><input type="checkbox" value="맛집"> 맛집</label>
          <label><input type="checkbox" value="운동"> 운동</label>
          <label><input type="checkbox" value="창작활동"> 창작활동</label>
          <label><input type="checkbox" value="단체 스포츠"> 단체 스포츠</label>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">가장 기억에 남는 컨텐츠나 활동 (복수 입력 가능)</label>
        <div style="margin-bottom:8px;">
          <strong>유튜브</strong> <input type="text" id="favYoutube" class="form-input" placeholder="유튜브 링크 (여러 개는 ,로 구분)">
        </div>
        <div style="margin-bottom:8px;">
          <strong>영화</strong> <input type="text" id="favMovie" class="form-input" placeholder="영화 제목/장르 (여러 개는 ,로 구분)">
        </div>
        <div style="margin-bottom:8px;">
          <strong>도서</strong> <input type="text" id="favBook" class="form-input" placeholder="책 이름/장르 (여러 개는 ,로 구분)">
        </div>
        <div>
          <strong>노래</strong> <input type="text" id="favMusic" class="form-input" placeholder="노래 제목/장르 (여러 개는 ,로 구분)">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">지금 즐겨하고 있는 취미 (복수 입력, 기타 가능)</label>
        <input type="text" id="currentHobbies" class="form-input" placeholder="예: 글쓰기, 드로잉, 달리기, ASMR, 요리 등">
      </div>
      <div class="navigation" style="justify-content: flex-end; gap: 16px;">
        <button class="nav-button" id="hobbyInfoPrev" style="margin-right:auto;">이전</button>
        <button class="nav-button" id="hobbyInfoNext">다음</button>
      </div>
    </div>

    <!-- Questions -->
    <div id="questionsContainer"></div>

    <!-- Results Screen -->
    <div class="results-container" id="resultsContainer">
      <div class="completion-message">검사가 완료되었습니다!</div>
      <div class="completion-subtitle">나의 성향 결과를 확인해보세요.</div>
      <div class="result-summary">
        <div class="user-welcome" id="resultWelcome">
          환영합니다, <span id="userName"></span>님!
        </div>
        <!-- “핵심 성향” 출력 영역 -->
        <div class="personality-type" id="resultType">
          성향: <strong>예시형 + 몰입형</strong>
        </div>
        <div class="type-description" id="typeDescription">
          여기에 사용자의 성향에 대한 자세한 설명이 표시됩니다.
        </div>

        <!-- 세부타입 확인 버튼 -->
        <button class="log-button" id="showAnalysisBtn" style="margin-bottom:16px;">
          세부유형 확인하기
        </button>

        <!-- 분석 영역: 기본적으로 숨김 -->
        <div id="analysisSection" style="display:none;">
          <!-- 서브타입별 집계 출력 영역 -->
          <div class="analysis-title">🔖 서브타입별 응답 분포</div>
          <div class="analysis-grid" id="subtypeAnalysisGrid"></div>

          <!-- SDT 3대 욕구별 집계 출력 영역 -->
          <div class="analysis-title">🌱 SDT 3대 욕구별 분포</div>
          <div class="analysis-grid" id="sdtAnalysisGrid"></div>
        </div>

        <!-- 예시 트레잇(탤런트)이나 키워드 태그 출력 영역(선택) -->
        <div class="result-keywords" id="keywordsContainer"></div>

        <button class="log-button" id="downloadLog">
          결과 로그 다운로드
        </button>
        <div class="action-buttons">
          <button class="action-button home" id="goHome">홈으로</button>
          <button class="action-button stats" id="viewStats">
            나 자세히 알아보기
          </button>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toastMessage">저장되었습니다!</div>
  </div>

  <script>
    //
    // ===============================
    // 1) QUESTIONS DATA
    // ===============================
    //
    const questions = [
      {
        number: 1,
        text: "어떤 상황에서 더 뿌듯함을 느끼나요?",
        category: "도전형 vs 돌봄형",
        options: [
          "복잡한 문제를 끝까지 해결했을 때",
          "친구에게 고민을 잘 들어줬을 때"
        ],
        emojis: ["🧩", "🤗"]
      },
      {
        number: 2,
        text: "더 설레는 순간은?",
        category: "탐험형 vs 연결형",
        options: [
          "새로운 도시를 자유롭게 탐험할 때",
          "좋아하는 친구들과 만남을 계획할 때"
        ],
        emojis: ["🌍", "👫"]
      },
      {
        number: 3,
        text: "창작 활동에서 어떤 점이 더 매력적이세요?",
        category: "창조형 vs 공유형",
        options: [
          "나만의 상상력을 발휘하는 것",
          "피드백을 받고 서로 발전하는 것"
        ],
        emojis: ["🎨", "🔄"]
      },
      {
        number: 4,
        text: "휴식이 필요할 때 어떤 활동을 하나요?",
        category: "감각형 vs 공감형",
        options: [
          "좋은 소리와 향을 느끼며 혼자 쉼",
          "감성적인 영화나 글로 감정에 젖기"
        ],
        emojis: ["🕯️", "🎬"]
      },
      {
        number: 5,
        text: "몰입의 즐거움을 느끼는 순간은?",
        category: "몰입형 vs 리듬형",
        options: [
          "러닝/코딩/독서에 집중할 때",
          "음악에 몸을 맡겨 리듬을 느낄 때"
        ],
        emojis: ["📚", "🎵"]
      },
      {
        number: 6,
        text: "여가를 보내는 이상적인 방식은?",
        category: "즉흥형 vs 연결형",
        options: [
          "즉흥적으로 나서는 혼자만의 여행",
          "친구들과 미리 계획한 모임 참여"
        ],
        emojis: ["🧳", "📅"]
      },
      {
        number: 7,
        text: "사람들과 있을 때 어떤 느낌이 드나요?",
        category: "개인형 vs 사회형",
        options: [
          "빨리 집에 가고 싶다",
          "함께 있을수록 더 활력이 생긴다"
        ],
        emojis: ["🏠", "🎉"]
      },
      {
        number: 8,
        text: "성공의 순간, 무엇이 떠오르나요?",
        category: "유능성 vs 관계성",
        options: [
          "스스로 터득해 낸 성취감",
          "함께 이뤄낸 성과의 기쁨"
        ],
        emojis: ["🏆", "🤝"]
      },
      {
        number: 9,
        text: "어떤 감정이 더 강하게 남나요?",
        category: "탐험형 vs 공감형",
        options: [
          "새롭고 낯선 걸 접했을 때의 경이로움",
          "누군가와 교감했을 때의 따뜻함"
        ],
        emojis: ["✨", "💞"]
      },
      {
        number: 10,
        text: "시간 가는 줄 모르게 빠지는 건?",
        category: "도전형 vs 공감형",
        options: [
          "분석, 추리, 목표 달성형 게임",
          "정서적 스토리가 있는 다큐/에세이"
        ],
        emojis: ["🕵️‍♂️", "📖"]
      },
      {
        number: 11,
        text: "팀 활동 중 더 끌리는 역할은?",
        category: "창조형 vs 돌봄형",
        options: ["기획자, 아이디어 제시", "조율자, 갈등 중재자"],
        emojis: ["💡", "🫂"]
      },
      {
        number: 12,
        text: "피곤할 때 선호하는 콘텐츠는?",
        category: "감각형 vs 공유형",
        options: [
          "ASMR, 먹방, 감각 자극형 영상",
          "사람 사는 이야기(브이로그, 인터뷰 등) 영상"
        ],
        emojis: ["🎧", "🗣️"]
      },
      {
        number: 13,
        text: "주말에 뭘 하며 시간을 보내고 싶나요?",
        category: "성장형 vs 공유형",
        options: ["코딩, 글쓰기, 자가학습", "친구와 전시회/북토크 가기"],
        emojis: ["💻", "📚"]
      },
      {
        number: 14,
        text: "기분이 가장 좋아질 때는?",
        category: "유능성 vs 관계성",
        options: ["나만의 성취를 완성했을 때", "감정을 타인과 나눴을 때"],
        emojis: ["🥇", "💬"]
      },
      {
        number: 15,
        text: "활동에서 무엇을 더 중시하나요?",
        category: "창조형 vs 즉흥형",
        options: ["내가 주도하고 통제할 수 있는 것", "즉석에서 변화를 수용하는 것"],
        emojis: ["📝", "🎲"]
      },
      {
        number: 16,
        text: "더 끌리는 콘텐츠는?",
        category: "도전형 vs 공감형",
        options: ["논리적인 미스터리나 추리물", "감정을 울리는 휴먼 스토리"],
        emojis: ["🧠", "😭"]
      },
      {
        number: 17,
        text: "의미 있는 여가는?",
        category: "감각형 vs 연결형",
        options: ["외부 자극 없이 감각에 집중하기", "감정이입 가능한 이야기와 사람들"],
        emojis: ["🛀", "👨‍👩‍👧‍👦"]
      },
      {
        number: 18,
        text: "운동을 할 때 무엇이 더 중요하나요?",
        category: "몰입형 vs 리듬/연결형",
        options: ["내 기록과의 싸움", "친구들과 함께하는 응원과 도전"],
        emojis: ["⏱️", "🏃‍♂️"]
      },
      {
        number: 19,
        text: "힘든 하루 끝에 어떤 방식으로 힐링하나요?",
        category: "개인형 vs 관계형",
        options: ["나만의 취미나 개인 시간", "친구와 감정을 나누는 수다"],
        emojis: ["🎣", "☕"]
      },
      {
        number: 20,
        text: "결과가 오래 걸려도 몰입 가능한 건?",
        category: "성장형 vs 연결형",
        options: ["배워가는 과정 자체가 흥미로운 것", "친구들과 함께 갈 수 있다면"],
        emojis: ["📈", "🚶‍♂️"]
      }
    ];

    //
    // ===============================
    // 2) SDT MAPPING TABLE
    // ===============================
    //
    // 각 서브타입(예: “도전형”, “돌봄형” 등)을 SDT 카테고리로 매핑
    //
    const sdtMapping = {
      // Autonomy 계열 (자율성)
      "탐험형": "Autonomy",
      "창조형": "Autonomy",
      "즉흥형": "Autonomy",
      "감각형": "Autonomy",
      "리듬형": "Autonomy",

      // Competence 계열 (역량)
      "도전형": "Competence",
      "몰입형": "Competence",
      "유능성": "Competence",
      "성장형": "Competence",

      // Relatedness 계열 (관계성)
      "돌봄형": "Relatedness",
      "공유형": "Relatedness",
      "공감형": "Relatedness",
      "관계성": "Relatedness",
      "연결형": "Relatedness",
      "사회형": "Relatedness"
    };

    //
    // ===============================
    // 3) STATE VARIABLES
    // ===============================
    //
    let currentStep = 0;
    const totalSteps = questions.length + 2; // 회원정보 + 취미/콘텐츠 + 질문 20 = 22단계
    const responses = { userInfo: {}, answers: [] };

    // DOM 요소 가져오기
    const userInfoCard = document.getElementById("userInfoCard");
    const userInfoNext = document.getElementById("userInfoNext");
    const questionsContainer = document.getElementById("questionsContainer");
    const progressFill = document.getElementById("progressFill");
    const stepIndicator = document.getElementById("stepIndicator");
    const resultsContainer = document.getElementById("resultsContainer");
    const userNameSpan = document.getElementById("userName");
    const resultTypeEl = document.getElementById("resultType");
    const typeDescriptionEl = document.getElementById("typeDescription");
    const subtypeAnalysisGrid = document.getElementById("subtypeAnalysisGrid");
    const sdtAnalysisGrid = document.getElementById("sdtAnalysisGrid");
    const downloadLogBtn = document.getElementById("downloadLog");
    const goHomeBtn = document.getElementById("goHome");
    const viewStatsBtn = document.getElementById("viewStats");
    const toastMessage = document.getElementById("toastMessage");
    const keywordsContainer = document.getElementById("keywordsContainer");
    const showAnalysisBtn = document.getElementById("showAnalysisBtn");
    const analysisSection = document.getElementById("analysisSection");
    const freeTimeRange = document.getElementById("freeTimeRange");
    const freeTimeValue = document.getElementById("freeTimeValue");

    //
    // ===============================
    // 4) PROGRESS BAR 업데이트 함수
    // ===============================
    //
    function updateProgress() {
      const percent = (currentStep / totalSteps) * 100;
      progressFill.style.width = `${percent}%`;
      // 단계별 안내
      if (currentStep === 0) {
        stepIndicator.innerText = `회원가입 1/${totalSteps}`;
      } else if (currentStep === 1) {
        stepIndicator.innerText = `회원가입 2/${totalSteps}`;
      } else if (currentStep <= 1 + questions.length) {
        stepIndicator.innerText = `성향 문답 ${currentStep - 1}/${questions.length}`;
      } else {
        stepIndicator.innerText = `결과`;
      }
    }

    //
    // ===============================
    // 5) 첫 화면: 회원가입 화면 표시
    // ===============================
    //
    function showUserInfo() {
      userInfoCard.style.display = "block";
      hobbyInfoCard.style.display = "none";
      questionsContainer.style.display = "none";
      resultsContainer.classList.remove("active");
    }

    //
    // ===============================
    // 6) 질문 카드 표시 함수
    // ===============================
    //
    function showQuestion(index) {
      userInfoCard.style.display = "none";
      hobbyInfoCard.style.display = "none";
      resultsContainer.classList.remove("active");
      questionsContainer.style.display = "block";
      questionsContainer.innerHTML = ""; // 기존 질문 초기화

      const q = questions[index];
      const card = document.createElement("div");
      card.className = "question-card active";

      // 질문 번호
      const numberEl = document.createElement("div");
      numberEl.className = "question-number";
      numberEl.innerText = `Q${q.number}`;
      // 질문 텍스트
      const textEl = document.createElement("div");
      textEl.className = "question-text";
      textEl.innerText = q.text;

      // 옵션 컨테이너
      const optionsEl = document.createElement("div");
      optionsEl.className = "options-container";

      // A/B 옵션 생성
      q.options.forEach((opt, i) => {
        const item = document.createElement("div");
        item.className = "option-item";
        item.addEventListener("click", () => selectOption(item, i));

        const radio = document.createElement("div");
        radio.className = "option-radio";
        const text = document.createElement("div");
        text.className = "option-text";
        text.innerText = opt;
        const emoji = document.createElement("div");
        emoji.className = "option-emoji";
        emoji.innerText = q.emojis[i];

        item.appendChild(radio);
        item.appendChild(text);
        item.appendChild(emoji);
        optionsEl.appendChild(item);
      });

      // 이전/다음 버튼
      const nav = document.createElement("div");
      nav.className = "navigation";
      const prevBtn = document.createElement("button");
      prevBtn.className = "nav-button";
      prevBtn.innerText = "이전";
      prevBtn.disabled = false; // 항상 활성화

      prevBtn.addEventListener("click", () => {
        if (index === 0) {
          // 첫 문항에서 이전 시 취미/콘텐츠 카드로 이동
          questionsContainer.style.display = "none";
          hobbyInfoCard.style.display = "block";
          currentStep = 1;
          updateProgress();
        } else {
          navigateQuestion(index - 1);
        }
      });

      const nextBtn = document.createElement("button");
      nextBtn.className = "nav-button next";
      nextBtn.innerText = index === questions.length - 1 ? "완료" : "다음";
      nextBtn.disabled = !responses.answers[index]; // 이미 응답이 있으면 활성화

      nextBtn.addEventListener("click", () => navigateQuestion(index + 1));

      nav.appendChild(prevBtn);
      nav.appendChild(nextBtn);

      // 카드에 붙이기
      card.appendChild(numberEl);
      card.appendChild(textEl);
      card.appendChild(optionsEl);
      card.appendChild(nav);

      questionsContainer.appendChild(card);

      // 옵션을 선택했을 때 호출되는 함수
      function selectOption(itemEl, optionIndex) {
        // 다른 옵션들 초기화
        const siblings = itemEl.parentElement.querySelectorAll(".option-item");
        siblings.forEach((sib) => sib.classList.remove("selected"));
        // 현재 옵션에 selected 클래스 추가
        itemEl.classList.add("selected");
        // 응답 데이터 저장
        responses.answers[index] = {
          question: q.text,
          answer: q.options[optionIndex]
        };
        // "다음" 버튼 활성화 (기존)
        nextBtn.disabled = false;

        // === 옵션 선택 즉시 다음 질문으로 이동 ===
        setTimeout(() => {
          if (index < questions.length - 1) {
            navigateQuestion(index + 1);
          } else {
            showResults();
          }
        }, 200); // 0.2초 후 이동 (선택 효과 보이게)
      }

      // 이미 응답이 있으면 해당 옵션을 미리 선택 표시
      if (responses.answers[index]) {
        const prevAnswer = responses.answers[index].answer;
        q.options.forEach((opt, i) => {
          if (opt === prevAnswer) {
            const optionItems = optionsEl.querySelectorAll(".option-item");
            optionItems[i].classList.add("selected");
            nextBtn.disabled = false;
          }
        });
      }
    }

    //
    // ===============================
    // 7) 질문 순서 이동 함수
    // ===============================
    //
    function navigateQuestion(newIndex) {
      // 만약 현재 인덱스에서 답변을 선택하지 않았다면 더 이동하지 않음
      if (
        newIndex > currentStep - 1 &&
        !responses.answers[currentStep - 1]
      )
        return;

      currentStep = newIndex + 1;
      updateProgress();

      if (newIndex < questions.length) {
        showQuestion(newIndex);
      } else {
        // 모든 질문이 끝나면 결과 화면 표시
        showResults();
      }
    }

    //
    // ===============================
    // 8) 결과 화면 표시 함수
    //   - 여기서 “SDT”, “서브타입별 카운트” 등을 계산
    // ===============================
    //
    function showResults() {
      analysisSection.style.display = "none";
      showAnalysisBtn.style.display = "block";
      questionsContainer.style.display = "none";
      resultsContainer.classList.add("active");

      // 검사 완료 시 상단 단계 표시를 "검사 결과"로 변경
      stepIndicator.innerText = "검사 결과";

      // 1) 사용자 이름 표시
      userNameSpan.innerText = responses.userInfo.name || "";

      // 2) “핵심 성향”을 실제 통계 기반으로 표시
      const subtypeCounts = {};
      const sdtCounts = {
        Autonomy: 0,
        Competence: 0,
        Relatedness: 0
      };

      responses.answers.forEach((ansObj, idx) => {
        const { question, answer } = ansObj;
        const matchedItem = questions.find((item) => item.text === question);
        if (!matchedItem) return;
        const [stypeA, stypeB] = matchedItem.category.split(" vs ").map((s) => s.trim());
        let chosenSubtype = null;
        if (answer === matchedItem.options[0]) {
          chosenSubtype = stypeA;
        } else if (answer === matchedItem.options[1]) {
          chosenSubtype = stypeB;
        } else {
          return;
        }
        subtypeCounts[chosenSubtype] = (subtypeCounts[chosenSubtype] || 0) + 1;
        const mappedSDT = sdtMapping[chosenSubtype];
        if (mappedSDT) sdtCounts[mappedSDT] += 1;
      });

      // 최다 선택 서브타입 2개 추출
      const sortedSubtypes = Object.entries(subtypeCounts)
        .sort((a, b) => b[1] - a[1])
        .map(([subtype]) => subtype);
      let mainType = "결과 없음";
      if (sortedSubtypes.length === 1) {
        mainType = sortedSubtypes[0];
      } else if (sortedSubtypes.length >= 2) {
        mainType = `${sortedSubtypes[0]} + ${sortedSubtypes[1]}`;
      }

      resultTypeEl.innerHTML = `성향: <strong>${mainType}</strong>`;

      // === 여기서 userInfo에 mainType 저장 ===
      responses.userInfo.mainType = mainType;
      // localStorage에 저장 (전체 responses를)
      localStorage.setItem('selfAwarenessSurvey', JSON.stringify(responses));

      typeDescriptionEl.innerText =
        "여기에 사용자의 성향에 대한 자세한 설명이 표시됩니다.";

      // 3) “서브타입별 카운트”와 “SDT별 카운트” 계산

      // 3-1) 각 서브타입(예: “도전형”, “돌봄형” 등)의 카운트를 저장할 객체
      const subtypeCounts2 = {};
      // 3-2) SDT 카테고리별 카운트를 저장할 객체
      const sdtCounts2 = {
        Autonomy: 0,
        Competence: 0,
        Relatedness: 0
      };

      // 3-3) 사용자가 응답한 answers 배열 순회
      responses.answers.forEach((ansObj, idx) => {
        const { question, answer } = ansObj;
        // 3-3-1) questions 배열에서 동일한 question 텍스트를 찾음
        const matchedItem = questions.find(
          (item) => item.text === question
        );
        if (!matchedItem) {
          console.warn(
            `질문을 찾을 수 없음: ${question}`
          );
          return;
        }
        // 3-3-2) category 예: "도전형 vs 돌봄형" → ["도전형", "돌봄형"]
        const [stypeA, stypeB] = matchedItem.category
          .split(" vs ")
          .map((s) => s.trim());

        // 3-3-3) 사용자가 선택한 답(answer)이 optionA인지 optionB인지 판별
        let chosenSubtype = null;
        if (answer === matchedItem.options[0]) {
          chosenSubtype = stypeA;
        } else if (answer === matchedItem.options[1]) {
          chosenSubtype = stypeB;
        } else {
          console.warn(
            `[주의] 응답이 옵션A/B와 일치하지 않음: ${answer}`
          );
          return;
        }

        // 3-3-4) 서브타입 카운트 증가
        if (subtypeCounts2[chosenSubtype]) {
          subtypeCounts2[chosenSubtype] += 1;
        } else {
          subtypeCounts2[chosenSubtype] = 1;
        }

        // 3-3-5) SDT 매핑을 통해 해당 서브타입이 어느 카테고리인지 찾아 카운트 증가
        const mappedSDT = sdtMapping[chosenSubtype];
        if (mappedSDT) {
          sdtCounts2[mappedSDT] += 1;
        } else {
          console.warn(
            `[주의] sdtMapping에 해당 서브타입 없음: ${chosenSubtype}`
          );
        }
      });

      // 4) “서브타입별 분석 결과” 영역에 카드로 렌더링
      subtypeAnalysisGrid.innerHTML = "";
      Object.entries(subtypeCounts2).forEach(([subtype, count]) => {
        const card = document.createElement("div");
        card.className = "analysis-card";
        const lbl = document.createElement("div");
        lbl.className = "analysis-label";
        lbl.innerText = subtype;
        const val = document.createElement("div");
        val.className = "analysis-value";
        val.innerText = `${count}회`;
        card.appendChild(lbl);
        card.appendChild(val);
        subtypeAnalysisGrid.appendChild(card);
      });

      // 만약 서브타입 카운트가 비어 있다면 (예상치 못한 에러) 안내 문구 추가
      if (Object.keys(subtypeCounts2).length === 0) {
        const emptyMsg = document.createElement("div");
        emptyMsg.innerText = "서브타입 응답이 없습니다.";
        subtypeAnalysisGrid.appendChild(emptyMsg);
      }

      // 5) “SDT 3대 욕구별 분석 결과” 영역에 카드로 렌더링
      sdtAnalysisGrid.innerHTML = "";
      Object.entries(sdtCounts2).forEach(([category, count]) => {
        const card = document.createElement("div");
        card.className = "analysis-card";
        const lbl = document.createElement("div");
        lbl.className = "analysis-label";
        lbl.innerText =
          category === "Autonomy"
            ? "자율성(Autonomy)"
            : category === "Competence"
            ? "역량(Competence)"
            : "관계성(Relatedness)";
        const val = document.createElement("div");
        val.className = "analysis-value";
        val.innerText = `${count}회`;
        card.appendChild(lbl);
        card.appendChild(val);
        sdtAnalysisGrid.appendChild(card);
      });

      // 만약 SDT 카운트가 모두 0이라면 안내 문구 추가
      if (
        sdtCounts2.Autonomy === 0 &&
        sdtCounts2.Competence === 0 &&
        sdtCounts2.Relatedness === 0
      ) {
        const emptyMsg2 = document.createElement("div");
        emptyMsg2.innerText = "SDT 분석 결과가 없습니다.";
        sdtAnalysisGrid.appendChild(emptyMsg2);
      }

      // 6) 키워드 태그(예시)
      keywordsContainer.innerHTML = "";
      // (필요하다면 실제 알고리즘로 태그를 결정하도록 변경할 수 있음)
      const exampleKeywords = ["#예술", "#자극", "#집중"];
      exampleKeywords.forEach((kw) => {
        const tag = document.createElement("div");
        tag.className = "keyword-tag";
        tag.innerText = kw;
        keywordsContainer.appendChild(tag);
      });
    }

    //
    // ===============================
    // 9) 사용자 정보 제출 처리
    // ===============================
    //
    userInfoNext.addEventListener("click", () => {
      const nameVal = document.getElementById("nameInput").value.trim();
      const ageVal = document.getElementById("ageInput").value.trim();
      const genderVal = document.getElementById("genderSelect").value;
      const jobCategories = Array.from(document.querySelectorAll('#jobCategories input[type="checkbox"]:checked')).map(cb => cb.value);
      const jobDetail = document.getElementById("jobDetailInput").value.trim();
      const freeTime = document.getElementById("freeTimeRange").value;

      if (!nameVal || !ageVal || !genderVal || !jobCategories.length) {
        alert("모든 항목을 입력해주세요.");
        return;
      }

      // userInfo만 responses에 저장
      responses.userInfo = {
        name: nameVal,
        age: ageVal,
        gender: genderVal,
        jobCategories,
        jobDetail,
        freeTime
      };

      // localStorage에 저장 (전체 responses를)
      localStorage.setItem('selfAwarenessSurvey', JSON.stringify(responses));

      // 1단계: 기본 정보 입력 → 다음 클릭 시
      userInfoCard.style.display = "none";
      hobbyInfoCard.style.display = "block"; // 취미/콘텐츠 카드만 보이게
      questionsContainer.style.display = "none";
      resultsContainer.classList.remove("active");
      currentStep = 1;
      updateProgress();
    });

    // 2단계: 취미 및 콘텐츠 입력 → 다음 클릭 시 (입력값 없어도 통과)
    hobbyInfoNext.addEventListener("click", () => {
      // 입력값 없어도 통과 가능 (선택사항임을 명시)
      hobbyInfoCard.style.display = "none";
      questionsContainer.style.display = "block"; // 질문 카드만 보이게
      showQuestion(0);
      resultsContainer.classList.remove("active");
      currentStep = 2;
      updateProgress();
    });

    // 질문 세션에서 완료 시 결과 화면으로 넘어감 (이미 구현됨)

    // 첫 화면: 기본 정보 입력만 보이게
    function showUserInfo() {
      userInfoCard.style.display = "block";
      hobbyInfoCard.style.display = "none";
      questionsContainer.style.display = "none";
      resultsContainer.classList.remove("active");
      currentStep = 0;
      updateProgress();
    }

    // 페이지 로드 시 초기화
    showUserInfo();

    // 현재 직업 및 주된 활동 추가
    const jobCategories = document.getElementById("jobCategories");
    const otherJobInput = document.getElementById("jobDetailInput");
    const jobBlocks = document.querySelectorAll(".job-block");

    jobBlocks.forEach((block) => {
      block.addEventListener("click", () => {
        block.classList.toggle("selected");
        updateJobCategories();
      });
    });

    function updateJobCategories() {
      const selectedJobs = Array.from(jobBlocks)
        .filter((block) => block.classList.contains("selected"))
        .map((block) => block.innerText.trim());
      jobCategories.value = selectedJobs.join(", ");
    }

    // 취미 및 콘텐츠 기반 초기 선호 섹션
    const otherHobbyInput = document.getElementById("currentHobbies");
    // 입력란 비활성화/초기화 코드 제거 (항상 입력 가능)

    // 나이 입력란에만 숫자 입력 가능하도록 제한
    const ageInput = document.getElementById("ageInput");
    ageInput.addEventListener("keypress", (e) => {
      if (!/[0-9]/.test(e.key)) {
        e.preventDefault();
      }
    });

    // 자유로운 시간 슬라이더 값 표시
    if (freeTimeRange && freeTimeValue) {
      freeTimeRange.addEventListener("input", () => {
        freeTimeValue.innerText = freeTimeRange.value;
      });
    }

    showAnalysisBtn.addEventListener("click", () => {
      // 실제 분석 결과 대신 안내 메시지만 표시
      analysisSection.style.display = "none";
      showAnalysisBtn.style.display = "none";

      typeDescriptionEl.innerText =
      `세부 유형을 보여드리엔 지금 정보가 살짝 부족해요 🧐\n
아직 개발 중인 기능이기도 해요!\n
챗봇과 얘기하면서 나에 대한 힌트를 더 모아봐요 💬🔍`;
  });    


    // "기타" 체크박스 체크 시에만 직접 입력란 표시
    const jobEtcCheckbox = document.querySelector('#jobCategories input[value="기타"]');
    const jobDetailInput = document.getElementById("jobDetailInput");

    // 처음에는 숨김 처리
    jobDetailInput.style.display = "none";

    // 체크박스 상태 변화 감지
    jobEtcCheckbox.addEventListener("change", function () {
      if (this.checked) {
        jobDetailInput.style.display = "block";
      } else {
        jobDetailInput.style.display = "none";
        jobDetailInput.value = ""; // 체크 해제 시 입력값도 초기화
      }
    });

    // 취미 및 콘텐츠 기반 초기 선호 카드 이전 버튼 기능 추가
    const hobbyInfoPrev = document.getElementById("hobbyInfoPrev");
    hobbyInfoPrev.addEventListener("click", () => {
      hobbyInfoCard.style.display = "none";
      userInfoCard.style.display = "block";
      questionsContainer.style.display = "none";
      resultsContainer.classList.remove("active");
      currentStep = 0;
      updateProgress();
    });
    goHomeBtn.addEventListener("click", function () {
  window.location.href = "home_Section.html";
});

viewStatsBtn.addEventListener("click", function () {
  window.location.href = "specify_myself.html";
});

downloadLogBtn.addEventListener("click", function () {
  // 다운로드할 데이터 구성
  const logData = {
    userInfo: responses.userInfo,
    answers: responses.answers,
    timestamp: new Date().toISOString()
  };
  const blob = new Blob([JSON.stringify(logData, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  // 다운로드 링크 생성 및 클릭
  const a = document.createElement("a");
  a.href = url;
  a.download = "성향분석_결과로그.json";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);

  // 토스트 메시지 표시(선택)
  if (toastMessage) {
    toastMessage.innerText = "결과 로그가 다운로드되었습니다!";
    toastMessage.style.display = "block";
    setTimeout(() => {
      toastMessage.style.display = "none";
    }, 2000);
  }
});

document.querySelectorAll('.options-container').forEach(container => {
  container.addEventListener('click', function(e) {
    const option = e.target.closest('.option-item');
    if (!option) return;

    // 선택 표시
    container.querySelectorAll('.option-item').forEach(item => item.classList.remove('selected'));
    option.classList.add('selected');

    // 값 저장 (예시: data-question-id, data-value 사용)
    const questionCard = option.closest('.question-card');
    const questionId = questionCard?.dataset.questionId;
    const value = option.dataset.value || option.innerText;
    if (questionId) {
      // responses 객체에 저장 (responses가 전역에 있다고 가정)
      if (!window.responses) window.responses = {};
      window.responses[questionId] = value;
    }

    // 다음 질문 카드로 이동
    if (questionCard) {
      questionCard.classList.remove('active');
      let nextCard = questionCard.nextElementSibling;
      while (nextCard && !nextCard.classList.contains('question-card')) {
        nextCard = nextCard.nextElementSibling;
      }
      if (nextCard && nextCard.classList.contains('question-card')) {
        nextCard.classList.add('active');
        // 필요시 progress bar 등 업데이트
      } else {
        // 마지막 질문이면 결과 처리
        // showResult() 등 결과 함수 호출
        if (typeof showResult === "function") showResult();
      }
    }
  });
});
  </script>
</body>
</html>
